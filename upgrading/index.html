


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    Upgrading | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />

    <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>
<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="/">Scylla Python Driver</a>
                    </li>
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">
            

            <div class="section" id="upgrading">
<h1>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="upgrading-from-dse-driver">
<h2>Upgrading from dse-driver<a class="headerlink" href="#upgrading-from-dse-driver" title="Permalink to this headline">¶</a></h2>
<p>Since 3.21.0, scylla-driver fully supports DataStax products. dse-driver and
dse-graph users should now migrate to scylla-driver to benefit from latest bug fixes
and new features. The upgrade to this new unified driver version is straightforward
with no major API changes.</p>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Only the <cite>scylla-driver</cite> package should be installed. <cite>dse-driver</cite> and <cite>dse-graph</cite>
are not required anymore:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">scylla</span><span class="o">-</span><span class="n">driver</span>
</pre></div>
</div>
<p>If you need the Graph <em>Fluent</em> API (features provided by dse-graph):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">scylla</span><span class="o">-</span><span class="n">driver</span><span class="p">[</span><span class="n">graph</span><span class="p">]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../installation/"><span class="doc">Installation</span></a> for more details.</p>
</div>
<div class="section" id="import-from-the-cassandra-module">
<h3>Import from the cassandra module<a class="headerlink" href="#import-from-the-cassandra-module" title="Permalink to this headline">¶</a></h3>
<p>There is no <cite>dse</cite> module, so you should import from the <cite>cassandra</cite> module. You
need to change only the first module of your import statements, not the submodules.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dse.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">EXEC_PROFILE_GRAPH_DEFAULT</span>
<span class="kn">from</span> <span class="nn">dse.auth</span> <span class="kn">import</span> <span class="n">PlainTextAuthProvider</span>
<span class="kn">from</span> <span class="nn">dse.policies</span> <span class="kn">import</span> <span class="n">WhiteListRoundRobinPolicy</span>

<span class="c1"># becomes</span>

<span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">EXEC_PROFILE_GRAPH_DEFAULT</span>
<span class="kn">from</span> <span class="nn">cassandra.auth</span> <span class="kn">import</span> <span class="n">PlainTextAuthProvider</span>
<span class="kn">from</span> <span class="nn">cassandra.policies</span> <span class="kn">import</span> <span class="n">WhiteListRoundRobinPolicy</span>
</pre></div>
</div>
<p>Also note that the cassandra.hosts module doesn’t exist in scylla-driver. This
module is named cassandra.pool.</p>
</div>
<div class="section" id="dse-graph">
<h3>dse-graph<a class="headerlink" href="#dse-graph" title="Permalink to this headline">¶</a></h3>
<p>dse-graph features are now built into scylla-driver. The only change you need
to do is your import statements:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dse_graph</span> <span class="kn">import</span> <span class="o">..</span>
<span class="kn">from</span> <span class="nn">dse_graph.query</span> <span class="kn">import</span> <span class="o">..</span>

<span class="c1"># becomes</span>

<span class="kn">from</span> <span class="nn">cassandra.datastax.graph.fluent</span> <span class="kn">import</span> <span class="o">..</span>
<span class="kn">from</span> <span class="nn">cassandra.datastax.graph.fluent.query</span> <span class="kn">import</span> <span class="o">..</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../api/cassandra/datastax/graph/fluent/#module-cassandra.datastax.graph.fluent" title="cassandra.datastax.graph.fluent"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fluent</span></code></a>.</p>
</div>
<div class="section" id="session-execute-and-session-execute-async-api">
<h3>Session.execute and Session.execute_async API<a class="headerlink" href="#session-execute-and-session-execute-async-api" title="Permalink to this headline">¶</a></h3>
<p>Although it is not common to use this API with positional arguments, it is
important to be aware that the <cite>host</cite> and <cite>execute_as</cite> parameters have had
their positional order swapped. This is only because <cite>execute_as</cite> was added
in dse-driver before <cite>host</cite>.</p>
<p>See <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Session.execute" title="cassandra.cluster.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a>.</p>
</div>
<div class="section" id="deprecations">
<h3>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h3>
<p>These changes are optional, but recommended:</p>
<ul class="simple">
<li>Importing from <cite>cassandra.graph</cite> is deprecated. Consider importing from <cite>cassandra.datastax.graph</cite>.</li>
<li>Use <a class="reference internal" href="../api/cassandra/policies/#cassandra.policies.DefaultLoadBalancingPolicy" title="cassandra.policies.DefaultLoadBalancingPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultLoadBalancingPolicy</span></code></a> instead of DSELoadBalancingPolicy.</li>
</ul>
</div>
</div>
<div class="section" id="upgrading-to-3-0">
<h2>Upgrading to 3.0<a class="headerlink" href="#upgrading-to-3-0" title="Permalink to this headline">¶</a></h2>
<p>Version 3.0 of the DataStax Python driver for Apache Cassandra
adds support for Cassandra 3.0 while maintaining support for
previously supported versions. In addition to substantial internal rework,
there are several updates to the API that integrators will need
to consider:</p>
<div class="section" id="default-consistency-is-now-local-one">
<h3>Default consistency is now <code class="docutils literal notranslate"><span class="pre">LOCAL_ONE</span></code><a class="headerlink" href="#default-consistency-is-now-local-one" title="Permalink to this headline">¶</a></h3>
<p>Previous value was <code class="docutils literal notranslate"><span class="pre">ONE</span></code>. The new value is introduced to mesh with the default
DC-aware load balancing policy and to match other drivers.</p>
</div>
<div class="section" id="execution-api-updates">
<h3>Execution API Updates<a class="headerlink" href="#execution-api-updates" title="Permalink to this headline">¶</a></h3>
<div class="section" id="result-return-normalization">
<h4>Result return normalization<a class="headerlink" href="#result-return-normalization" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-368">PYTHON-368</a></p>
<p>Previously results would be returned as a <code class="docutils literal notranslate"><span class="pre">list</span></code> of rows for result rows
up to <code class="docutils literal notranslate"><span class="pre">fetch_size</span></code>, and <code class="docutils literal notranslate"><span class="pre">PagedResult</span></code> afterward. This could break
application code that assumed one type and got another.</p>
<p>Now, all results are returned as an iterable <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.ResultSet" title="cassandra.cluster.ResultSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSet</span></code></a>.</p>
<p>The preferred way to consume results of unknown size is to iterate through
them, letting automatic paging occur as they are consumed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM system.local&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">process</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>If the expected size of the results is known, it is still possible to
materialize a list using the iterator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM system.local&quot;</span><span class="p">)</span>
<span class="n">row_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>For backward compatibility, <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.ResultSet" title="cassandra.cluster.ResultSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSet</span></code></a> supports indexing. When
accessed at an index, a <cite>~.ResultSet</cite> object will materialize all its pages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM system.local&quot;</span><span class="p">)</span>
<span class="n">first_result</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># materializes results, fetching all pages</span>
</pre></div>
</div>
<p>This can send requests and load (possibly large) results into memory, so
<cite>~.ResultSet</cite> will log a warning on implicit materialization.</p>
</div>
<div class="section" id="trace-information-is-not-attached-to-executed-statements">
<h4>Trace information is not attached to executed Statements<a class="headerlink" href="#trace-information-is-not-attached-to-executed-statements" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-318">PYTHON-318</a></p>
<p>Previously trace data was attached to Statements if tracing was enabled. This
could lead to confusion if the same statement was used for multiple executions.</p>
<p>Now, trace data is associated with the <code class="docutils literal notranslate"><span class="pre">ResponseFuture</span></code> and <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code>
returned for each query:</p>
<p><a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.ResponseFuture.get_query_trace" title="cassandra.cluster.ResponseFuture.get_query_trace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ResponseFuture.get_query_trace()</span></code></a></p>
<p><a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.ResponseFuture.get_all_query_traces" title="cassandra.cluster.ResponseFuture.get_all_query_traces"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ResponseFuture.get_all_query_traces()</span></code></a></p>
<p><a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.ResultSet.get_query_trace" title="cassandra.cluster.ResultSet.get_query_trace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ResultSet.get_query_trace()</span></code></a></p>
<p><a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.ResultSet.get_all_query_traces" title="cassandra.cluster.ResultSet.get_all_query_traces"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ResultSet.get_all_query_traces()</span></code></a></p>
</div>
<div class="section" id="binding-named-parameters-now-ignores-extra-names">
<h4>Binding named parameters now ignores extra names<a class="headerlink" href="#binding-named-parameters-now-ignores-extra-names" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-178Cassadfasdf">PYTHON-178</a></p>
<p>Previously, <a class="reference internal" href="../api/cassandra/query/#cassandra.query.BoundStatement.bind" title="cassandra.query.BoundStatement.bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BoundStatement.bind()</span></code></a> would raise if a mapping
was passed with extra names not found in the prepared statement.</p>
<p>Behavior in 3.0+ is to ignore extra names.</p>
</div>
</div>
<div class="section" id="blist-removed-as-soft-dependency">
<h3>blist removed as soft dependency<a class="headerlink" href="#blist-removed-as-soft-dependency" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-385">PYTHON-385</a></p>
<p>Previously the driver had a soft dependency on <code class="docutils literal notranslate"><span class="pre">blist</span> <span class="pre">sortedset</span></code>, using
that where available and using an internal fallback where possible.</p>
<p>Now, the driver never chooses the <code class="docutils literal notranslate"><span class="pre">blist</span></code> variant, instead returning the
internal <a class="reference internal" href="../api/cassandra/util/#cassandra.util.SortedSet" title="cassandra.util.SortedSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">util.SortedSet</span></code></a> for all <code class="docutils literal notranslate"><span class="pre">set</span></code> results. The class implements
all standard set operations, so no integration code should need to change unless
it explicitly checks for <code class="docutils literal notranslate"><span class="pre">sortedset</span></code> type.</p>
</div>
<div class="section" id="metadata-api-updates">
<h3>Metadata API Updates<a class="headerlink" href="#metadata-api-updates" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-276">PYTHON-276</a>, <a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-408">PYTHON-408</a>, <a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-400">PYTHON-400</a>, <a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-422">PYTHON-422</a></p>
<p>Cassandra 3.0 brought a substantial overhaul to the internal schema metadata representation.
This version of the driver supports that metadata in addition to the legacy version. Doing so
also brought some changes to the metadata model.</p>
<p>The present API is documented: <a class="reference internal" href="../api/cassandra/metadata/#module-cassandra.metadata" title="cassandra.metadata"><code class="xref any py py-mod docutils literal notranslate"><span class="pre">cassandra.metadata</span></code></a>. Changes highlighted below:</p>
<ul class="simple">
<li>All types are now exposed as CQL types instead of types derived from the internal server implementation</li>
<li>Some metadata attributes have changed names to match current nomenclature (for example, <code class="xref py py-attr docutils literal notranslate"><span class="pre">Index.kind</span></code> in place of <code class="docutils literal notranslate"><span class="pre">Index.type</span></code>).</li>
<li>Some metadata attributes removed<ul>
<li><code class="docutils literal notranslate"><span class="pre">TableMetadata.keyspace</span></code> reference replaced with <a class="reference internal" href="../api/cassandra/metadata/#cassandra.metadata.TableMetadata.keyspace_name" title="cassandra.metadata.TableMetadata.keyspace_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TableMetadata.keyspace_name</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">ColumnMetadata.index</span></code> is removed table- and keyspace-level mappings are still maintained</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="several-deprecated-features-are-removed">
<h3>Several deprecated features are removed<a class="headerlink" href="#several-deprecated-features-are-removed" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-292">PYTHON-292</a></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ResponseFuture.result</span></code> timeout parameter is removed, use <code class="docutils literal notranslate"><span class="pre">Session.execute</span></code> timeout instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/031ebb0">031ebb0</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">Cluster.refresh_schema</span></code> removed, use <code class="docutils literal notranslate"><span class="pre">Cluster.refresh_*_metadata</span></code> instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/419fcdf">419fcdf</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">Cluster.submit_schema_refresh</span></code> removed (<a class="reference external" href="https://github.com/datastax/python-driver/commit/574266d">574266d</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cqltypes</span></code> time/date functions removed, use <code class="docutils literal notranslate"><span class="pre">util</span></code> entry points instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/bb984ee">bb984ee</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">decoder</span></code> module removed (<a class="reference external" href="https://github.com/datastax/python-driver/commit/e16a073">e16a073</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">TableMetadata.keyspace</span></code> attribute replaced with <code class="docutils literal notranslate"><span class="pre">keyspace_name</span></code> (<a class="reference external" href="https://github.com/datastax/python-driver/commit/cc94073">cc94073</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cqlengine.columns.TimeUUID.from_datetime</span></code> removed, use <code class="docutils literal notranslate"><span class="pre">util</span></code> variant instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/96489cc">96489cc</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cqlengine.columns.Float(double_precision)</span></code> parameter removed, use <code class="docutils literal notranslate"><span class="pre">columns.Double</span></code> instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/a2d3a98">a2d3a98</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cqlengine</span></code> keyspace management functions are removed in favor of the strategy-specific entry points (<a class="reference external" href="https://github.com/datastax/python-driver/commit/4bd5909">4bd5909</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cqlengine.Model.__polymorphic_*__</span></code> attributes removed, use <code class="docutils literal notranslate"><span class="pre">__discriminator*</span></code> attributes instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/9d98c8e">9d98c8e</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">cqlengine.statements</span></code> will no longer warn about list list prepend behavior (<a class="reference external" href="https://github.com/datastax/python-driver/commit/79efe97">79efe97</a>)</li>
</ul>
</div>
</div>
<div class="section" id="upgrading-to-2-1-from-2-0">
<h2>Upgrading to 2.1 from 2.0<a class="headerlink" href="#upgrading-to-2-1-from-2-0" title="Permalink to this headline">¶</a></h2>
<p>Version 2.1 of the DataStax Python driver for Apache Cassandra
adds support for Cassandra 2.1 and version 3 of the native protocol.</p>
<p>Cassandra 1.2, 2.0, and 2.1 are all supported.  However, 1.2 only
supports protocol version 1, and 2.0 only supports versions 1 and
2, so some features may not be available.</p>
<div class="section" id="using-the-v3-native-protocol">
<h3>Using the v3 Native Protocol<a class="headerlink" href="#using-the-v3-native-protocol" title="Permalink to this headline">¶</a></h3>
<p>By default, the driver will attempt to use version 2 of the
native protocol.  To use version 3, you must explicitly
set the <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal notranslate"><span class="pre">protocol_version</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that protocol version 3 is only supported by Cassandra 2.1+.</p>
<p>In future releases, the driver may default to using protocol version
3.</p>
</div>
<div class="section" id="working-with-user-defined-types">
<h3>Working with User-Defined Types<a class="headerlink" href="#working-with-user-defined-types" title="Permalink to this headline">¶</a></h3>
<p>Cassandra 2.1 introduced the ability to define new types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">KEYSPACE</span> <span class="n">mykeyspace</span><span class="p">;</span>

<span class="n">CREATE</span> <span class="n">TYPE</span> <span class="n">address</span> <span class="p">(</span><span class="n">street</span> <span class="n">text</span><span class="p">,</span> <span class="n">city</span> <span class="n">text</span><span class="p">,</span> <span class="nb">zip</span> <span class="nb">int</span><span class="p">);</span>
</pre></div>
</div>
<p>The driver generally expects you to use instances of a specific
class to represent column values of this type.  You can let the
driver know what class to use with <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Cluster.register_user_type" title="cassandra.cluster.Cluster.register_user_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cluster.register_user_type()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">zipcode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="n">street</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zipcode</span> <span class="o">=</span> <span class="n">zipcode</span>

<span class="n">cluster</span><span class="o">.</span><span class="n">register_user_type</span><span class="p">(</span><span class="s1">&#39;mykeyspace&#39;</span><span class="p">,</span> <span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span>
</pre></div>
</div>
<p>When inserting data for <code class="docutils literal notranslate"><span class="pre">address</span></code> columns, you should pass in
instances of <code class="docutils literal notranslate"><span class="pre">Address</span></code>.  When querying data, <code class="docutils literal notranslate"><span class="pre">address</span></code> column
values will be instances of <code class="docutils literal notranslate"><span class="pre">Address</span></code>.</p>
<p>If no class is registered for a user-defined type, query results
will use a <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> class and data may only be inserted
though prepared statements.</p>
<p>See <a class="reference internal" href="../user_defined_types/#udts"><span class="std std-ref">User Defined Types</span></a> for more details.</p>
</div>
<div class="section" id="customizing-encoders-for-non-prepared-statements">
<h3>Customizing Encoders for Non-prepared Statements<a class="headerlink" href="#customizing-encoders-for-non-prepared-statements" title="Permalink to this headline">¶</a></h3>
<p>Starting with version 2.1 of the driver, it is possible to customize
how Python types are converted to CQL literals when working with
non-prepared statements.  This is done on a per-<a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Session" title="cassandra.cluster.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
basis through <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Session.encoder" title="cassandra.cluster.Session.encoder"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.encoder</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">cql_encode_tuple</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../getting_started/#type-conversions"><span class="std std-ref">Type Conversions</span></a> for the table of default CQL literal conversions.</p>
</div>
<div class="section" id="using-client-side-protocol-level-timestamps">
<h3>Using Client-Side Protocol-Level Timestamps<a class="headerlink" href="#using-client-side-protocol-level-timestamps" title="Permalink to this headline">¶</a></h3>
<p>With version 3 of the native protocol, timestamps may be supplied by the
client at the protocol level.  (Normally, if they are not specified within
the CQL query itself, a timestamp is generated server-side.)</p>
<p>When <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal notranslate"><span class="pre">protocol_version</span></code></a> is set to 3 or higher, the driver
will automatically use client-side timestamps with microsecond precision
unless <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Session.use_client_timestamp" title="cassandra.cluster.Session.use_client_timestamp"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.use_client_timestamp</span></code></a> is changed to <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code>.
If a timestamp is specified within the CQL query, it will override the
timestamp generated by the driver.</p>
</div>
</div>
<div class="section" id="upgrading-to-2-0-from-1-x">
<h2>Upgrading to 2.0 from 1.x<a class="headerlink" href="#upgrading-to-2-0-from-1-x" title="Permalink to this headline">¶</a></h2>
<p>Version 2.0 of the DataStax Python driver for Apache Cassandra
includes some notable improvements over version 1.x.  This version
of the driver supports Cassandra 1.2, 2.0, and 2.1.  However, not
all features may be used with Cassandra 1.2, and some new features
in 2.1 are not yet supported.</p>
<div class="section" id="using-the-v2-native-protocol">
<h3>Using the v2 Native Protocol<a class="headerlink" href="#using-the-v2-native-protocol" title="Permalink to this headline">¶</a></h3>
<p>By default, the driver will attempt to use version 2 of Cassandra’s
native protocol. You can explicitly set the protocol version to
2, though:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>When working with Cassandra 1.2, you will need to
explicitly set the <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal notranslate"><span class="pre">protocol_version</span></code></a> to 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-query-paging">
<h3>Automatic Query Paging<a class="headerlink" href="#automatic-query-paging" title="Permalink to this headline">¶</a></h3>
<p>Version 2 of the native protocol adds support for automatic query
paging, which can make dealing with large result sets much simpler.</p>
<p>See <a class="reference internal" href="../query_paging/#query-paging"><span class="std std-ref">Paging Large Queries</span></a> for full details.</p>
</div>
<div class="section" id="protocol-level-batch-statements">
<h3>Protocol-Level Batch Statements<a class="headerlink" href="#protocol-level-batch-statements" title="Permalink to this headline">¶</a></h3>
<p>With version 1 of the native protocol, batching of statements required
using a <a class="reference external" href="http://cassandra.apache.org/doc/cql3/CQL-3.0.html#batchStmt">BATCH cql query</a>.
With version 2 of the native protocol, you can now batch statements at
the protocol level. This allows you to use many different prepared
statements within a single batch.</p>
<p>See <a class="reference internal" href="../api/cassandra/query/#cassandra.query.BatchStatement" title="cassandra.query.BatchStatement"><code class="xref py py-class docutils literal notranslate"><span class="pre">BatchStatement</span></code></a> for details and usage examples.</p>
</div>
<div class="section" id="sasl-based-authentication">
<h3>SASL-based Authentication<a class="headerlink" href="#sasl-based-authentication" title="Permalink to this headline">¶</a></h3>
<p>Also new in version 2 of the native protocol is SASL-based authentication.
See the section on <a class="reference internal" href="../security/#security"><span class="std std-ref">Security</span></a> for details and examples.</p>
</div>
<div class="section" id="lightweight-transactions">
<h3>Lightweight Transactions<a class="headerlink" href="#lightweight-transactions" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.datastax.com/dev/blog/lightweight-transactions-in-cassandra-2-0">Lightweight transactions</a> are another new feature.  To use lightweight transactions, add <code class="docutils literal notranslate"><span class="pre">IF</span></code> clauses
to your CQL queries and set the <a class="reference internal" href="../api/cassandra/query/#cassandra.query.Statement.serial_consistency_level" title="cassandra.query.Statement.serial_consistency_level"><code class="xref py py-attr docutils literal notranslate"><span class="pre">serial_consistency_level</span></code></a>
on your statements.</p>
</div>
<div class="section" id="calling-cluster-shutdown">
<h3>Calling Cluster.shutdown()<a class="headerlink" href="#calling-cluster-shutdown" title="Permalink to this headline">¶</a></h3>
<p>In order to fix some issues around garbage collection and unclean interpreter
shutdowns, version 2.0 of the driver requires you to call <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Cluster.shutdown" title="cassandra.cluster.Cluster.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cluster.shutdown()</span></code></a>
on your <a class="reference internal" href="../api/cassandra/cluster/#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cluster</span></code></a> objects when you are through with them.
This helps to guarantee a clean shutdown.</p>
</div>
<div class="section" id="id2">
<h3>Deprecations<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The following functions have moved from <code class="docutils literal notranslate"><span class="pre">cassandra.decoder</span></code> to <code class="docutils literal notranslate"><span class="pre">cassandra.query</span></code>.
The original functions have been left in place with a <code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> for
now:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/cassandra/decoder/#cassandra.decoder.tuple_factory" title="cassandra.decoder.tuple_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.decoder.tuple_factory</span></code></a> has moved to
<a class="reference internal" href="../api/cassandra/query/#cassandra.query.tuple_factory" title="cassandra.query.tuple_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.query.tuple_factory</span></code></a></li>
<li><a class="reference internal" href="../api/cassandra/decoder/#cassandra.decoder.named_tuple_factory" title="cassandra.decoder.named_tuple_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.decoder.named_tuple_factory</span></code></a> has moved to
<a class="reference internal" href="../api/cassandra/query/#cassandra.query.named_tuple_factory" title="cassandra.query.named_tuple_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.query.named_tuple_factory</span></code></a></li>
<li><a class="reference internal" href="../api/cassandra/decoder/#cassandra.decoder.dict_factory" title="cassandra.decoder.dict_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.decoder.dict_factory</span></code></a> has moved to
<a class="reference internal" href="../api/cassandra/query/#cassandra.query.dict_factory" title="cassandra.query.dict_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.query.dict_factory</span></code></a></li>
<li><a class="reference internal" href="../api/cassandra/decoder/#cassandra.decoder.ordered_dict_factory" title="cassandra.decoder.ordered_dict_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.decoder.ordered_dict_factory</span></code></a> has moved to
<a class="reference internal" href="../api/cassandra/query/#cassandra.query.ordered_dict_factory" title="cassandra.query.ordered_dict_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cassandra.query.ordered_dict_factory</span></code></a></li>
</ul>
</div>
<div class="section" id="dependency-changes">
<h3>Dependency Changes<a class="headerlink" href="#dependency-changes" title="Permalink to this headline">¶</a></h3>
<p>The following dependencies have officially been made optional:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">scales</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">blist</span></code></li>
</ul>
<p>And one new dependency has been added (to enable Python 3 support):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">six</span></code></li>
</ul>
</div>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scylla_specific/">Scylla Specific Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgrading</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../execution_profiles/">Execution Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/">Performance Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query_paging/">Paging Large Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lwt/">Lightweight Transactions (Compare-and-set)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_defined_types/">User Defined Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../object_mapper/">Object Mapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dates_and_times/">Working with Dates and Times</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/python-driver/issues/new?title=Issue in page Upgrading&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20http://docs.scylladb.com/upgrading%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2013-2017 DataStax
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../_static/js/vendor/jquery.js"></script>
<script src="../_static/expertrec.js"></script>
<script src="../_static/js/foundation/foundation.js"></script>
<script src="../_static/js/foundation/foundation.topbar.js"></script>
<script src="../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>